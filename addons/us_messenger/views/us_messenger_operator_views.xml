<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <record id="messenger_operator_action" model="ir.actions.act_window">
        <field name="name">Operators</field>
        <field name="res_model">us.messenger.operator</field>
        <field name="view_mode">kanban</field>
    </record>

    <record id="discuss_channel_view_list" model="ir.ui.view">
        <field name="name">discuss.channel.list</field>
        <field name="model">us.messenger.partner</field>
        <field name="arch" type="xml">
            <list js_class="us_messenger.discuss_channel_list" string="History" delete="false" create="false" default_order="create_date desc">
                <field name="channel_id" column_invisible="True"/>
                <field name="messenger_operator_id" column_invisible="True"/>
                <field name="create_date" string="Session Date"/>
                <field name="name" string="Participants"/>
                <field name="message_count" string="# Messages"/>
                <button name="action_become_operator" type="object" class="oe_highlight"
                        string="JOIN" invisible="messenger_operator_id"/>
                <button name="action_change_operator" type="object" class="oe_highlight" groups="us_messenger.us_messenger_group_user"
                        string="CHANGE OPERATOR" invisible="is_hide or not messenger_operator_id"/>
                <button name="action_change_operator" type="object" class="oe_highlight" groups="us_messenger.us_messenger_group_manager"
                        string="CHANGE OPERATOR" invisible="not(is_hide and messenger_operator_id)"/>
            </list>
        </field>
    </record>

    <record id="view_us_messenger_operator_kanban" model="ir.ui.view">
        <field name="name">us.messenger.operator.kanban</field>
        <field name="model">us.messenger.operator</field>
        <field name="arch" type="xml">
            <kanban default_group_by="bot_id" type="object" action="get_action"
                    default_order="user_id esc" group_create="false" group_delete="false" group_edit="false"
                    create="false" records_draggable="false">
                <field name="user_id"/>
                <field name="bot_id"/>
                <field name="name"/>
                <field name="channel_count"/>
                <field name="activity_state"/>
                <field name="messenger_color"/>
                <field name="color"/>
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_content oe_kanban_color_#{record.color.raw_value} oe_kanban_global_click">
                            <div class="row">
                                <div class="col-12">
                                    <strong><field name="name"/></strong>
                                </div>
                            </div>
                            <div>
                                <span t-attf-class="badge rounded-pill o_tag o_tag_color_#{record.messenger_color.raw_value}"><field name="activity_state"/></span>
                            </div>
                            <div class="o_kanban_record_bottom">
                                <div class="oe_kanban_bottom_left">
                                    <span><field name="channel_count"/> channels</span>
                                </div>
                                <div class="oe_kanban_bottom_right" t-if="record.user_id.raw_value">
                                    <field name="user_id" widget="many2one_avatar_user" domain="[('share', '=', False)]"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
</odoo>